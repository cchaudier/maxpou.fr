<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.131b48b25a50eff60b34.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.23.11"/><style data-styled="" data-styled-version="5.1.1">.dpQIFR{top:0;left:0;margin:0 auto;display:block;width:100%;z-index:1000;background-color:rgba(32,35,42,0.85);font-weight:700;}/*!sc*/
@media (min-width:700px){.dpQIFR{position:fixed;}}/*!sc*/
data-styled.g6[id="Header__HeaderWrapper-sc-1glvhxp-0"]{content:"dpQIFR,"}/*!sc*/
.iIPppa{font-weight:700;margin-left:auto;margin-right:auto;height:60px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;max-width:770px;z-index:1000;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding:0px 20px;}/*!sc*/
data-styled.g7[id="Header__HeaderNav-sc-1glvhxp-1"]{content:"iIPppa,"}/*!sc*/
.kNsALo{display:none;-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:700px){.kNsALo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}/*!sc*/
data-styled.g8[id="Header__HeaderLinksContainer-sc-1glvhxp-2"]{content:"kNsALo,"}/*!sc*/
.elLHjJ{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;border:0;margin:0;padding:8px 10px;min-width:42px;z-index:10;}/*!sc*/
.elLHjJ + .Header__HeaderLink-sc-1glvhxp-3{margin-left:0.7rem;}/*!sc*/
data-styled.g9[id="Header__HeaderLink-sc-1glvhxp-3"]{content:"elLHjJ,"}/*!sc*/
.jwglPC{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;border:0;margin:0;padding:8px 10px;min-width:42px;z-index:10;padding-left:0;}/*!sc*/
.jwglPC + .Header__HeaderLinkTitle-sc-1glvhxp-4{margin-left:0.7rem;}/*!sc*/
data-styled.g10[id="Header__HeaderLinkTitle-sc-1glvhxp-4"]{content:"jwglPC,"}/*!sc*/
.fbZJYq{display:block;padding-left:0;}/*!sc*/
data-styled.g11[id="Header__HeaderLinkTitleContent-sc-1glvhxp-5"]{content:"fbZJYq,"}/*!sc*/
.kLFzRf{z-index:30;top:0px;position:relative;color:#ffffff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:transparent;border:none;cursor:pointer;padding:8px 12px;outline:none;-webkit-tap-highlight-color:transparent;}/*!sc*/
@media (min-width:700px){.kLFzRf{display:none;}}/*!sc*/
data-styled.g15[id="Header__BurgerButton-sc-1glvhxp-9"]{content:"kLFzRf,"}/*!sc*/
.bbASxq{width:24px;height:2px;background:#ffffff;position:absolute;left:0;background:#ffffff;-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.bbASxq::before{content:'';top:-8px;width:24px;height:2px;background:#ffffff;position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.bbASxq::after{top:8px;content:'';width:24px;height:2px;background:white;position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
data-styled.g16[id="Header__BurgerContent-sc-1glvhxp-10"]{content:"bbASxq,"}/*!sc*/
.cjpVI{text-align:left;padding-top:30px;padding-bottom:50px;background-color:#3E4047;color:#ffffff;padding-left:20px;padding-right:20px;margin:0 auto;}/*!sc*/
.cjpVI nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;max-width:900px;margin:0 auto;}/*!sc*/
.cjpVI nav .footer-col{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-right:1em;}/*!sc*/
.cjpVI a{color:#ffffff;font-weight:bold;}/*!sc*/
.cjpVI a:hover{color:#CFCFD1;}/*!sc*/
.cjpVI .footer-col > p{margin:0;}/*!sc*/
.cjpVI .footer-title{font-size:0.83em;margin:0 0 1rem;}/*!sc*/
.cjpVI .footer-item{color:#ffffff;}/*!sc*/
.cjpVI .footer-item a{padding:0.25rem 0;display:block;}/*!sc*/
.cjpVI .footer-heart{color:red;}/*!sc*/
.cjpVI .footer-item-text{padding:0.1rem 0;color:#ffffff;}/*!sc*/
.cjpVI .footer-header{-webkit-order:1;-ms-flex-order:1;order:1;margin:0 0.25rem;margin-right:0.25rem;padding:0.25rem;}/*!sc*/
.cjpVI .footer-column-items{grid-template-columns:1fr;display:grid;}/*!sc*/
@media (max-width:564px){.cjpVI .footer-col:first-child{width:100%;}}/*!sc*/
data-styled.g17[id="Footer__FooterWrapper-t92llg-0"]{content:"cjpVI,"}/*!sc*/
.kRszmU{display:inline-block;color:#697980;margin:0 4px;}/*!sc*/
.kRszmU::before{content:'•';}/*!sc*/
data-styled.g20[id="Commons__Bull-sc-1aaxjtz-2"]{content:"kRszmU,"}/*!sc*/
.hegtTu{margin:0 0;}/*!sc*/
@media (min-width:700px){.hegtTu{margin:60px 0;}}/*!sc*/
data-styled.g21[id="layout__SiteContent-nrr2ov-0"]{content:"hegtTu,"}/*!sc*/
.fWddfO{position:relative;border-radius:5px;width:80%;max-width:770px;word-wrap:break-word;background-color:#ffffff;margin:0px auto 30px auto;top:30px;padding:50px;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);}/*!sc*/
@media (max-width:780px){.fWddfO{width:100%;padding:25px;}}/*!sc*/
data-styled.g22[id="Wrapper-xmiwfw-0"]{content:"fWddfO,"}/*!sc*/
.jcNLtE{padding-right:0.5rem;padding-bottom:0.2rem;}/*!sc*/
data-styled.g23[id="Flag__FlagImage-sc-1n11y4w-0"]{content:"jcNLtE,"}/*!sc*/
.dbLdmy{position:relative;display:table;width:100%;height:400px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:cover;}/*!sc*/
data-styled.g27[id="Hero__HeroContainer-sc-1wsaguq-0"]{content:"dbLdmy,"}/*!sc*/
.jqsDAr{display:table-cell;vertical-align:middle;text-align:center;width:100%;}/*!sc*/
data-styled.g28[id="Hero__TitleContainer-sc-1wsaguq-1"]{content:"jqsDAr,"}/*!sc*/
.hBxyTz{font-weight:700;font-size:3rem;margin:10px 50px;color:#ffffff;text-shadow:1px 1px 4px rgba(34,34,34,0.85);}/*!sc*/
data-styled.g29[id="Hero__HeroTitle-sc-1wsaguq-2"]{content:"hBxyTz,"}/*!sc*/
.eesUgi{display:inline;color:#697980;}/*!sc*/
data-styled.g31[id="TagList__ListContainer-tgjq80-0"]{content:"eesUgi,"}/*!sc*/
.kqIzSH{text-transform:uppercase;color:#697980;}/*!sc*/
.kqIzSH:not(:first-child){margin-left:0.3rem;}/*!sc*/
.kqIzSH:hover{border-bottom:1px dotted #57595d;}/*!sc*/
.kqIzSH:before{content:'#';}/*!sc*/
data-styled.g32[id="TagList__TagListItemLink-tgjq80-1"]{content:"kqIzSH,"}/*!sc*/
.eOjJiY{text-transform:uppercase;color:#697980;}/*!sc*/
.eOjJiY:not(:first-child){margin-left:0.3rem;}/*!sc*/
.eOjJiY:before{content:'#';}/*!sc*/
data-styled.g33[id="TagList__TagListItem-tgjq80-2"]{content:"eOjJiY,"}/*!sc*/
.fPQfTW .author-image{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-40px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;z-index:2;box-shadow:#ececec 0 0 0 1px;background-color:#ffffff;}/*!sc*/
.fPQfTW .author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:center center;border-radius:100%;}/*!sc*/
.fPQfTW .author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0 auto;box-shadow:none;}/*!sc*/
data-styled.g46[id="Bio__BioWrapper-d7fgaq-0"]{content:"fPQfTW,"}/*!sc*/
.cbNTHN{line-height:1.6;margin:1em 0 0 0;}/*!sc*/
.cbNTHN a{box-shadow:0 2px 0 0 #ffdc4e;}/*!sc*/
.cbNTHN a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
data-styled.g47[id="Bio__BioText-d7fgaq-1"]{content:"cbNTHN,"}/*!sc*/
.iptoXi{margin-bottom:2rem;color:#57595d;font-size:0.9em;}/*!sc*/
data-styled.g51[id="ContentHeader__Header-sc-1qtxhip-0"]{content:"iptoXi,"}/*!sc*/
.fMKffk{line-height:1.6;}/*!sc*/
.fMKffk > h2{padding-top:3rem;margin-top:3rem;border-top:1px solid #ececec;}/*!sc*/
.fMKffk > h3{padding-top:3rem;}/*!sc*/
.fMKffk > p{margin:1em 0 0 0;}/*!sc*/
.fMKffk a{box-shadow:0 2px 0 0 #ffdc4e;}/*!sc*/
.fMKffk a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
.fMKffk a.anchor,.fMKffk a.gatsby-resp-image-link{box-shadow:none;}/*!sc*/
.fMKffk h1 .anchor svg,.fMKffk h2 .anchor svg,.fMKffk h3 .anchor svg,.fMKffk h4 .anchor svg,.fMKffk h5 .anchor svg,.fMKffk h6 .anchor svg{visibility:hidden;margin-left:-16px;}/*!sc*/
.fMKffk h1:hover .anchor svg,.fMKffk h2:hover .anchor svg,.fMKffk h3:hover .anchor svg,.fMKffk h4:hover .anchor svg,.fMKffk h5:hover .anchor svg,.fMKffk h6:hover .anchor svg,.fMKffk h1 .anchor:focus svg,.fMKffk h2 .anchor:focus svg,.fMKffk h3 .anchor:focus svg,.fMKffk h4 .anchor:focus svg,.fMKffk h5 .anchor:focus svg,.fMKffk h6 .anchor:focus svg{visibility:visible;}/*!sc*/
.fMKffk > blockquote{box-sizing:border-box;background-color:#f7f7f7;border-left:5px solid rgb(244,213,36);margin:30px 0px;padding:5px 20px;border-radius:0 8px 8px 0;}/*!sc*/
.fMKffk > blockquote p{margin:0.8em 0;font-style:italic;}/*!sc*/
.fMKffk .gatsby-highlight{border-radius:5px;font-size:15px;line-height:1.7;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1.5em;}/*!sc*/
@media (max-width:500px){.fMKffk .gatsby-highlight{border-radius:0;margin-left:-25px;margin-right:-25px;}}/*!sc*/
.fMKffk .gatsby-highlight > pre{border:0;margin:0;padding:1;}/*!sc*/
.fMKffk .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;}/*!sc*/
.fMKffk .gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #ffdc4e;}/*!sc*/
.fMKffk h1 > code.language-text,.fMKffk h2 > code.language-text,.fMKffk h3 > code.language-text,.fMKffk h4 > code.language-text,.fMKffk h5 > code.language-text,.fMKffk h6 > code.language-text,.fMKffk a > code.language-text,.fMKffk p > code.language-text,.fMKffk li > code.language-text,.fMKffk em > code.language-text,.fMKffk strong > code.language-text{background:#fff9d9;color:#222222cc;padding:0 3px;font-size:0.94em;border-radius:0.3rem;word-wrap:break-word;}/*!sc*/
.fMKffk code{word-wrap:break-word;}/*!sc*/
.fMKffk table{margin-top:1em;border-collapse:collapse;border-radius:0.5em;overflow:hidden;}/*!sc*/
.fMKffk table th,.fMKffk table td{padding:0.5em;background:#f7f7f7;border-bottom:2px solid #ffffff;}/*!sc*/
data-styled.g52[id="Content__ContentBody-p0bolz-0"]{content:"fMKffk,"}/*!sc*/
.cjwPUL{padding:0 30px 30px;}/*!sc*/
@media only screen and (max-width:500px){.cjwPUL{padding:0;}}/*!sc*/
data-styled.g53[id="Article__ArticleWrapper-jwdbi9-0"]{content:"cjwPUL,"}/*!sc*/
.bgRibg{position:relative;margin:6rem 0 0;padding:3rem 0 0;border-top:1px solid #ececec;}/*!sc*/
data-styled.g54[id="Article__ArticleFooter-jwdbi9-1"]{content:"bgRibg,"}/*!sc*/
.hTzgna{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:770px;width:80%;margin:0px auto 30px auto;top:20px;position:relative;}/*!sc*/
@media (max-width:780px){.hTzgna{width:100%;padding:25px;}}/*!sc*/
data-styled.g55[id="PrevNextPost__PreviewContainer-sc-1r1qyep-0"]{content:"hTzgna,"}/*!sc*/
.idbZOY{cursor:pointer;-webkit-flex:1 1 300px;-ms-flex:1 1 300px;flex:1 1 300px;background-color:#ffffff;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);margin:20px 20px;border-radius:5px;}/*!sc*/
.idbZOY:hover{box-shadow:0 0 0 0,0 6px 12px #B2B3B5;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;-webkit-transform:translate3D(0,-1px,0);-ms-transform:translate3D(0,-1px,0);transform:translate3D(0,-1px,0);}/*!sc*/
@media (min-width:780px){.idbZOY:first-child{margin-left:0;}.idbZOY:last-child{margin-right:0;}}/*!sc*/
data-styled.g56[id="PrevNextPost__Preview-sc-1r1qyep-1"]{content:"idbZOY,"}/*!sc*/
.lanPji{width:auto;height:200px;background:#c5d2d9 no-repeat 50%;background-size:cover;border-radius:5px 5px 0 0;}/*!sc*/
data-styled.g57[id="PrevNextPost__PreviewCover-sc-1r1qyep-2"]{content:"lanPji,"}/*!sc*/
.enysgX{padding:20px;}/*!sc*/
.enysgX header{padding:0 0 10px 0;}/*!sc*/
.enysgX section{padding-bottom:10px;}/*!sc*/
.enysgX footer{font-size:0.8em;}/*!sc*/
data-styled.g58[id="PrevNextPost__PreviewContent-sc-1r1qyep-3"]{content:"enysgX,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;}/*!sc*/
body{font-family:"Lato",sans-serif;color:#3E4047;background-color:#f4f8fb;}/*!sc*/
img{max-width:100%;height:auto;vertical-align:middle;border:0;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;color:#3E4047;}/*!sc*/
hr{border:0;border-top:1px solid #ECECED;margin:50px 0 5px 0;}/*!sc*/
ul,ol{padding-left:2em;margin:1em 0 0 0;}/*!sc*/
*::selection{background-color:#ffdc4e;}/*!sc*/
data-styled.g60[id="sc-global-aBoXv1"]{content:"sc-global-aBoXv1,"}/*!sc*/
.joXPMq{text-transform:uppercase;color:#697980;}/*!sc*/
data-styled.g61[id="Commons__ReadingTimeContainer-sc-1aaxjtz-3"]{content:"joXPMq,"}/*!sc*/
.eWatVx{color:#697980;}/*!sc*/
data-styled.g62[id="Time__TimeContainer-sc-1u6vd0l-0"]{content:"eWatVx,"}/*!sc*/
</style><title data-react-helmet="true">Utiliser Redis pour stocker le cache de Doctrine | Maxence Poutord</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Lato:400,700&amp;display=swap" rel="stylesheet"/><link data-react-helmet="true" rel="canonical" href="https://www.maxpou.fr/cache-doctrine-avec-redis"/><meta data-react-helmet="true" name="description" content="La meilleur requête est celle que l&#x27;on a pas à faire
—  un inconnu Dans mon actuelle mission, nous développons une application sous Symfony…"/><meta data-react-helmet="true" property="og:url" content="https://www.maxpou.fr/cache-doctrine-avec-redis"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Utiliser Redis pour stocker le cache de Doctrine | Maxence Poutord"/><meta data-react-helmet="true" property="og:description" content="La meilleur requête est celle que l&#x27;on a pas à faire
—  un inconnu Dans mon actuelle mission, nous développons une application sous Symfony…"/><meta data-react-helmet="true" property="og:image" content="https://www.maxpou.fr/static/1171885bb2b718192a51704eb5605f07/header.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="_maxpou"/><meta data-react-helmet="true" name="twitter:title" content="Utiliser Redis pour stocker le cache de Doctrine | Maxence Poutord"/><meta data-react-helmet="true" name="twitter:description" content="La meilleur requête est celle que l&#x27;on a pas à faire
—  un inconnu Dans mon actuelle mission, nous développons une application sous Symfony…"/><meta data-react-helmet="true" name="twitter:image" content="https://www.maxpou.fr/static/1171885bb2b718192a51704eb5605f07/header.png"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=9760e642bf7a05b3ba35950d80435566"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog (EN)" href="/rss-en.xml"/><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog (FR)" href="/rss-fr.xml"/><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-25d10a0ba71c72a2011c.js"/><link as="script" rel="preload" href="/framework-95b680cb3190aa9bfe59.js"/><link as="script" rel="preload" href="/app-72fe72edc09187d23e20.js"/><link as="script" rel="preload" href="/styles-c2fe8482057191dca484.js"/><link as="script" rel="preload" href="/75f61cbc8b4957b70288e42efd9d48e28ad28b43-9c65d1c119555ed86450.js"/><link as="script" rel="preload" href="/cd67464b56c598a654fc65ad34d4a5dd4dc63f41-8a06726a359f3d026d46.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-starter-morning-dew-src-templates-blog-post-js-2bec6febe87b94e09fbd.js"/><link as="fetch" rel="preload" href="/page-data/cache-doctrine-avec-redis/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="Header__HeaderWrapper-sc-1glvhxp-0 dpQIFR"><nav class="Header__HeaderNav-sc-1glvhxp-1 iIPppa"><a aria-label="View home page" class="Header__HeaderLink-sc-1glvhxp-3 Header__HeaderLinkTitle-sc-1glvhxp-4 jwglPC" href="/"><span class="Header__HeaderLinkTitleContent-sc-1glvhxp-5 fbZJYq">maxpou.fr</span></a><div class="Header__HeaderLinksContainer-sc-1glvhxp-2 kNsALo"><a aria-label="View Blog page" class="Header__HeaderLink-sc-1glvhxp-3 elLHjJ" href="/">Blog</a><a aria-label="View Speaking page" class="Header__HeaderLink-sc-1glvhxp-3 elLHjJ" href="/speaking">Speaking</a><a aria-label="View About page" class="Header__HeaderLink-sc-1glvhxp-3 elLHjJ" href="/about">About</a></div><button aria-label="open menu" class="Header__BurgerButton-sc-1glvhxp-9 kLFzRf"><div class="Header__BurgerContent-sc-1glvhxp-10 bbASxq"></div></button></nav></header><div class="layout__SiteContent-nrr2ov-0 hegtTu"><div style="background-image:url(&quot;/static/1171885bb2b718192a51704eb5605f07/header.png&quot;)" class="Hero__HeroContainer-sc-1wsaguq-0 dbLdmy"><div class="Hero__TitleContainer-sc-1wsaguq-1 jqsDAr"><h1 class="Hero__HeroTitle-sc-1wsaguq-2 hBxyTz">Utiliser Redis pour stocker le cache de Doctrine</h1></div></div><main role="main" class="Wrapper-xmiwfw-0 fWddfO"><article class="Article__ArticleWrapper-jwdbi9-0 cjwPUL"><section><header class="ContentHeader__Header-sc-1qtxhip-0 iptoXi"><time class="Time__TimeContainer-sc-1u6vd0l-0 eWatVx">8 March 2016</time><span class="Commons__Bull-sc-1aaxjtz-2 kRszmU"></span><div class="TagList__ListContainer-tgjq80-0 eesUgi"><a class="TagList__TagListItemLink-tgjq80-1 kqIzSH" href="/tags/Symfony2">Symfony2</a>, <a class="TagList__TagListItemLink-tgjq80-1 kqIzSH" href="/tags/Doctrine">Doctrine</a>, <a class="TagList__TagListItemLink-tgjq80-1 kqIzSH" href="/tags/Redis">Redis</a></div></header><div class="Content__ContentBody-p0bolz-0 fMKffk"><blockquote><p>La meilleur requête est celle que l’on a pas à faire
— <strong>un inconnu</strong></p></blockquote><p>Dans mon actuelle mission, nous développons une application sous Symfony2 avec Doctrine comme ORM.
Voici grossièrement à quoi ressemble l’architecture globale :</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:58.78378378378378%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcSAAAXEgFnn9JSAAACsUlEQVQoz2NgQAMnXyxn0A/iBLOZWBgEWViZVYBMcSDmBWIWIJYAYmUg5mPABnpnz/e4dOuex/9/f93////PgybNBMSMBamVEqWl5XX29k61ciriUkAxVm5uLlasBrau3fd/4s7zQLP+/3v57aEDQxoD66LrmQITzvrz9Z8I4geKM4VnOzo4Obn+NzW1/K8tb2gG0udnEce4ZsMKxgP7DzDt2rULbBaYnrxg+f/Usob/Cxcu+L/r/NLAigvSklPPh6tMuhCg1Hc8QGXxH1fJqskJgZ4e7v8TE2P/10fOrWBjWMGC7jAXFxdGMOPF4wcBs6ZNDmxuafUHuoYbmy9A4jW1U5tnzNrYAmSLRQr16zQZ7WU+f/uY+N7d+wwvXb7IwYALrLxWxdhz0Zlx0gV/xsW30xlnhKgzg8RfNrX23y+r7gexGywaOEt1VjssX7Rq/8FDB/+vWLEyGCjMIS0tLYxh4JrbVYztp+wZJl7wZ9j+vJmxmwscMQyvGyv2v2us3A1TV2GwznfW5Pkndu3eCQyuRWFAIRFhYWEphv4FS/RPX75q8OvHd32gd1hxeJm1umhyubNVTBWbHwN7if4K7RLtVbw9k9tUZkyf6QaMDF644o61e/4vPH4HFMv/H3y85G67koFvzpUESWCkiLfv85E6/T+WLyzLzt3R0em/ianpfx+1jOKtDphhbWZmBomUiYtW/08oafi/ds3q/3vOrfbJvcgiOO18lCww2UjPvBYu/fJ/Am9pf5SXg4PD//DwiP9tBdMcoa5mbG5uZlqyZAnzxo0bwWatWLGCgeHKxfNZ/X092XX1DZlARYJoFrOBEnFPwwyF2traxbNmzZp/5Ow+VaAYt5qaOicDMWDttUbGuD5tsPM5uFkEObhYZYBMUOxxATEoxiXY2NikQYZi0w8AB1gY99cBhCYAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <picture>
        <source srcSet="/static/0340deb42b7103aa574a14527451c2ab/cbe2e/architecture.webp 148w,/static/0340deb42b7103aa574a14527451c2ab/3084c/architecture.webp 295w,/static/0340deb42b7103aa574a14527451c2ab/5ca24/architecture.webp 590w,/static/0340deb42b7103aa574a14527451c2ab/487e2/architecture.webp 625w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
        <source srcSet="/static/0340deb42b7103aa574a14527451c2ab/12f09/architecture.png 148w,/static/0340deb42b7103aa574a14527451c2ab/e4a3f/architecture.png 295w,/static/0340deb42b7103aa574a14527451c2ab/fcda8/architecture.png 590w,/static/0340deb42b7103aa574a14527451c2ab/80d71/architecture.png 625w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
        <img class="gatsby-resp-image-image" src="/static/0340deb42b7103aa574a14527451c2ab/fcda8/architecture.png" alt="architecture globale" title="architecture globale" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
      </picture>
    </span></p><p>Comme vous le voyez, l’application est dédoublée sur deux serveurs distincts qui ont interdiction de se parler, en dehors de la base de données. Nous avons été confrontés à des problématiques de performances qui nous a contraint d’utiliser le <strong>cache de Doctrine</strong>.</p><p>Il faut savoir qu’il y a <a href="http://doctrine-orm.readthedocs.org/en/latest/reference/caching.html">3 types de cache pour Doctrine</a> :</p><ul><li>Query Cache : transformation DQL -&gt; SQL;</li><li>Result Cache : résultat de la requête;</li><li>Metadata Cache : annotation des entities.</li></ul><p>Si on regarde <a href="http://doctrine-orm.readthedocs.org/en/latest/reference/caching.html#cache-drivers">la liste des drivers</a>, on s’aperçoit qu’il n’est pas évident de mutualiser du cache entre plusieurs serveur (qui ne peuvent pas communiquer directement ensemble).</p><p>C’est là que Redis arrive ♥</p><p>En quelques mots, Redis (pour <em>REmote DIctionary Server</em>) est un SGBD <strong>clé-valeur</strong> qui s’inscrit dans la mouvance NoSQL. En plus d’être simple d’utilisation, sa performance qui ferait pâlir Usain Bolt. Cela est principalement dû au fait que tout est persisté dans le cache du serveur. Si vous doutez encore de cette dernière phrase, sachez que <a href="http://highscalability.com/blog/2012/4/2/youporn-targeting-200-million-views-a-day-and-beyond.html">YouPorn</a>, <a href="http://nickcraver.com/blog/2016/02/17/stack-overflow-the-architecture-2016-edition/">Stack Overflow</a>, <a href="https://github.com/blog/530-how-we-made-github-fast">Github</a>… l’utilisent ;-)</p><p>Voici un exemple de fonctionnement :</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">&gt;</span> SET name <span class="token string">&quot;maxence&quot;</span>
OK
<span class="token operator">&gt;</span> GET name
<span class="token string">&quot;maxence&quot;</span>
<span class="token operator">&gt;</span> KEYS *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
<span class="token comment"># Assigner un TTL sur une variable</span>
<span class="token operator">&gt;</span> SETEX mission <span class="token number">10</span> <span class="token string">&quot;votre mission si vous l&#x27;acceptez... ce message s&#x27;autodétruira dans 10s&quot;</span>
OK
<span class="token comment"># 10&#x27; après, le couple clef/valeur a disparu</span>
<span class="token operator">&gt;</span> GET mission
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span></code></pre></div><h2 id="installation" style="position:relative"><a href="#installation" aria-label="installation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2><p>L’installation de Redis est plutôt simple et se fait en quelques lignes de commande :</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># download</span>
<span class="token function">wget</span> http://download.redis.io/redis-stable.tar.gz
<span class="token function">tar</span> xvzf redis-stable.tar.gz
<span class="token builtin class-name">cd</span> redis-stable
<span class="token function">make</span>
<span class="token comment"># install</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token comment"># start</span>
redis-server</code></pre></div><p>Il va ensuite falloir installer les bundles qui vont bien :</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">composer require snc/redis-bundle <span class="token number">2</span>.x-dev
composer require predis/predis ^1.0</code></pre></div><p>Et on modifie le app/AppKernel.php:</p><div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">registerBundles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$bundles</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">new</span> <span class="token class-name">Snc<span class="token punctuation">\</span>RedisBundle<span class="token punctuation">\</span>SncRedisBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></span></code></pre></div><p>Dans le config.yml :</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">imports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">resource</span><span class="token punctuation">:</span> redis.yml <span class="token punctuation">}</span>

<span class="token comment"># Doctrine Configuration</span>
<span class="token key atrule">doctrine</span><span class="token punctuation">:</span>
    <span class="token key atrule">dbal</span><span class="token punctuation">:</span>
        <span class="token comment">#...</span>
    <span class="token key atrule">orm</span><span class="token punctuation">:</span>
        <span class="token key atrule">auto_generate_proxy_classes</span><span class="token punctuation">:</span> <span class="token string">&quot;%kernel.debug%&quot;</span>
        <span class="token key atrule">naming_strategy</span><span class="token punctuation">:</span> doctrine.orm.naming_strategy.underscore
        <span class="token comment"># IMPORTANT!</span>
        <span class="token key atrule">auto_mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">metadata_cache_driver</span><span class="token punctuation">:</span> redis
        <span class="token key atrule">query_cache_driver</span><span class="token punctuation">:</span> redis

<span class="token comment"># redis.yml</span>
<span class="token key atrule">snc_redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">clients</span><span class="token punctuation">:</span>
        <span class="token key atrule">default</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> predis
            <span class="token key atrule">alias</span><span class="token punctuation">:</span> default
            <span class="token key atrule">dsn</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>//1.2.3.4
        <span class="token key atrule">doctrine</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> predis
            <span class="token key atrule">alias</span><span class="token punctuation">:</span> doctrine
            <span class="token key atrule">dsn</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>//1.2.3.4
    <span class="token key atrule">doctrine</span><span class="token punctuation">:</span>
        <span class="token key atrule">metadata_cache</span><span class="token punctuation">:</span>
            <span class="token key atrule">client</span><span class="token punctuation">:</span> doctrine
            <span class="token key atrule">entity_manager</span><span class="token punctuation">:</span> default
            <span class="token key atrule">document_manager</span><span class="token punctuation">:</span> default
        <span class="token key atrule">result_cache</span><span class="token punctuation">:</span>
            <span class="token key atrule">client</span><span class="token punctuation">:</span> doctrine
            <span class="token key atrule">entity_manager</span><span class="token punctuation">:</span> default
        <span class="token key atrule">query_cache</span><span class="token punctuation">:</span>
            <span class="token key atrule">client</span><span class="token punctuation">:</span> doctrine
            <span class="token key atrule">entity_manager</span><span class="token punctuation">:</span> default</code></pre></div><p>Et voilà pour l’installation.<br/>
<!-- -->A ce stade, seuls les caches de metadata et de query sont opérationnels. Pour la mise en cache du résultat, il faudra le faire <strong>manuellement sur chaque requête</strong>.</p><h2 id="mettre-en-cache-le-résultat" style="position:relative"><a href="#mettre-en-cache-le-r%C3%A9sultat" aria-label="mettre en cache le résultat permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mettre en cache le résultat</h2><p>Terminé les requêtes <em>inlines</em> dans les controllers ! Vous allez désormais devoir utiliser le <abbr title="Doctrine Query Language">DQL</abbr> ou le QueryBuilder.</p><div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findBeers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createQuery</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">&#x27;select beers from MaxpouBeerBundle:Beers b&#x27;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">;</span>

    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">useResultCache</span><span class="token punctuation">(</span><span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setResultCacheLifetime</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3600sec = 1 hour</span>

    <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></code></pre></div><p>Maintenant, si l’on recharge la page, cette requête ne se fera plus via MySQL mais bien via Redis.
On peut vérifier tout cela en allant sur Redis et en rentrant la commande suivante : <code class="language-text">KEYS *</code>.
Voici ce que l’on va avoir :</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">&gt;</span> KEYS *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;[Maxpou<span class="token entity" title="\\">\\</span>BeerBundle<span class="token entity" title="\\">\\</span>Entity<span class="token entity" title="\\">\\</span>Beer<span class="token variable">$CLASSMETADATA</span>][1]&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;[809cd863587594a754a7ffda5c2c06ee4640ebe3][1]&quot;</span></code></pre></div><p>La première ligne va contenir les métadonnées de la classe Beer. La seconde, contiendra la requête <strong>et</strong> son résultat.
Si vous voulez avoir une clé un peu plus digeste, vous pouvez utiliser cette méthode <code class="language-text">$query-&gt;setResultCacheId(&#x27;my_wonderful_key&#x27;);</code> ou même faire <strong>1 pierre 3 coups</strong> : <code class="language-text">$query-&gt;useResultCache(true, 3600, &#x27;my_wonderful_key&#x27;);</code>.</p><p>Voici ce que nous aurons : (je n’ai pas réussi à supprimer le <code class="language-text">[1]</code>)</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">&gt;</span> KEYS *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;[Maxpou<span class="token entity" title="\\">\\</span>BeerBundle<span class="token entity" title="\\">\\</span>Entity<span class="token entity" title="\\">\\</span>Beer<span class="token variable">$CLASSMETADATA</span>][1]&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;[my_wonderful_key][1]&quot;</span></code></pre></div><p>Pour nettoyer le cache, voici quelques commandes :</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Nettoyer cache des queries</span>
php app/console doctrine:cache:clear-query
<span class="token comment"># Nettoyer cache des metadatas</span>
php app/console doctrine:cache:clear-metadata
<span class="token comment"># Nettoyer cache des résultats</span>
php app/console doctrine:cache:clear-result
<span class="token comment"># Vider la base redis</span>
php app/console redis:flushdb</code></pre></div><h2 id="invalider-le-cache-des-requêtes" style="position:relative"><a href="#invalider-le-cache-des-requ%C3%AAtes" aria-label="invalider le cache des requêtes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Invalider le cache des requêtes</h2><p>C’est bien de mettre en place un système de cache, mais vous n’allez pas demander à vos utilisateurs de lancer la commande après chaque opération. Il va donc falloir utiliser les événements de Doctrine, et plus particulièrement l’<a href="http://doctrine-orm.readthedocs.org/projects/doctrine-orm/en/latest/reference/events.html#entity-listeners">entity listeners</a>
Si vous faites des tests, pensez à commenter le cache des métadonnées ;-)</p><p>Définissez le service :</p><div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Maxpou<span class="token punctuation">\</span>BeerBundle<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Doctrine<span class="token punctuation">\</span>ORM<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>LifecycleEventArgs</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Maxpou<span class="token punctuation">\</span>BeerBundle<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Beer</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BeerListener</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$cacheDriver</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$cacheDriver</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cacheDriver</span> <span class="token operator">=</span> <span class="token variable">$cacheDriver</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">postPersist</span><span class="token punctuation">(</span>Beer <span class="token variable">$beer</span><span class="token punctuation">,</span> LifecycleEventArgs <span class="token variable">$args</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cacheDriver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&#x27;[beers_all][1]&#x27;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">postUpdate</span><span class="token punctuation">(</span>Beer <span class="token variable">$beer</span><span class="token punctuation">,</span> LifecycleEventArgs <span class="token variable">$args</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cacheDriver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&#x27;[beers_all][1]&#x27;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">postRemove</span><span class="token punctuation">(</span>Beer <span class="token variable">$beer</span><span class="token punctuation">,</span> LifecycleEventArgs <span class="token variable">$args</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cacheDriver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&#x27;[beers_all][1]&#x27;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre></div><p>Ici, <code class="language-text">beer_all</code> est le nom de l’id assigné au cache.</p><p>Le service.yml :</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">beer_listener</span><span class="token punctuation">:</span>
    <span class="token key atrule">class</span><span class="token punctuation">:</span> Maxpou\BeerBundle\Service\BeerListener
    <span class="token key atrule">arguments</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;@snc_redis.doctrine&quot;</span>
    <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> doctrine.orm.entity_listener <span class="token punctuation">}</span></code></pre></div><p>Et enfin l’annotation sur l’entity :</p><div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">/**
 * Beer
 *
 * @ORM\Table(name=&quot;beers&quot;)
 * @ORM\Entity(repositoryClass=&quot;Maxpou\BeerBundle\Repository\BeerRepository&quot;)
 * @ORM\EntityListeners({&quot;Maxpou\BeerBundle\Service\BeerListener&quot;})
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Beer</span> <span class="token keyword">implements</span> <span class="token class-name">BeerInterface</span>
<span class="token punctuation">{</span>
<span class="token comment">//...</span></span></code></pre></div><p>Les plus pointilleux d’entre vous auront remarqués que je redéfini le TTL de ma clef au lieu de la supprimer. En effet, si je supprime ma clef, la nouvelle clef créée sera <code class="language-text">[beers_all][2]</code>. Et le compteur augmentera ainsi de suite…<br/>
<!-- -->Avec cette technique <s>de fainéant</s>, on garde la main sur le nom de la clef qui sera toujours <code class="language-text">[beers_all][1]</code>.</p><h2 id="pour-aller-plus-loin" style="position:relative"><a href="#pour-aller-plus-loin" aria-label="pour aller plus loin permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pour aller plus loin</h2><ul><li>Tutoriel/Sandbox Redis : <a href="http://try.redis.io">http://try.redis.io</a></li><li><a href="http://doctrine-orm.readthedocs.org/projects/doctrine-orm/en/latest/reference/second-level-cache.html">2e niveau de cache de Doctrine (encore à l’état expérimental)</a></li></ul><h2 id="tips" style="position:relative"><a href="#tips" aria-label="tips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tips</h2><p>Utiliser les pipes unix avec le redis-cli : <code class="language-text">echo  &quot;KEYS *&quot; | ./path/to/redis-cli | grep beer</code><br/>
<!-- -->Vérifier le <abbr title="Time To Live">TTL</abbr> d’une clef: <code class="language-text">TTL [beer-id-42][1]</code></p></div></section><footer class="Article__ArticleFooter-jwdbi9-1 bgRibg"><div class="Bio__BioWrapper-d7fgaq-0 fPQfTW"><figure class="author-image"><div alt="Maxence Poutord" style="background-image:url(&quot;/static/9760e642bf7a05b3ba35950d80435566/2244e/avatar.jpg&quot;)" class="img"></div></figure><section><h4>About the author</h4><p class="Commons__Text-sc-1aaxjtz-1 Bio__BioText-d7fgaq-1 cbNTHN">
  Maxence Poutord is a software engineer specialized in web technologies. 
  On his day to day job, he is working as a senior front-end engineer at VSware.
  As a digital nomad, he lives where the WiFi and sun are!<br>
  You can also find him on Twitter <a href="https://twitter.com/_maxpou" rel="noopener" target="_blank">@_maxpou</a>.
  </p></section></div></footer></article></main><main role="main" class="Wrapper-xmiwfw-0 fWddfO"><div shortname="maxpou" config="[object Object]" id="disqus_thread"></div></main><aside class="PrevNextPost__PreviewContainer-sc-1r1qyep-0 hTzgna"><article class="PrevNextPost__Preview-sc-1r1qyep-1 idbZOY"><a aria-label="View Productivité Ninja ! article" href="/productivite-ninja"><div style="background-image:url(&quot;/static/eec960b0c4fdc35fe78d195d1d7b8287/abstract-5.jpg&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 lanPji"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 enysgX"><header><h2><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAKnRFWHRDcmVhdGlvbiBUaW1lAEZyIDkgTm92IDIwMDcgMTY6Mjc6MDYgKzAxMDAM3ZqdAAAAB3RJTUUH1wsJDxwzm8yD2gAAAAlwSFlzAAALEgAACxIB0t1+/AAAAARnQU1BAACxjwv8YQUAAAHdSURBVHjaxVO7btRAFD3zsNdxQIqQqBYk6ghR0tLxDXwCn8HX0BGlo6JCKAqCIlVCkCjQLgkgxbDB67XnlXPHRvsJGWs04/F53ZkxcNtNvXj5arG7uzf3KfJNIUSFh/dn2H9Qc564pABj0Z98hPt6CsVHyzoCrv6tl/bO3Xvzx0+fw0cveugp8ORRjWf7e1lAmi5naKuAHh2QSI4RpQbeHBzOrSfIBQ/vAzWRE8jcDQNCQk4g3TtinMtkEUHfIaxW0OIqa55rMTEYu3xXWm/r1AYZ5AYolqoJ6D4dU1jDCjFkMrskoFukKG2ys56EFEkyC38abE4+w1z/heU3K0Q/OUchp0zNxCCuU+sX37F69xZYt9CmQDHKUYDwQMPIONpo9A5o2gH9ZoPBjwKm5h78/glcs+ayylQtpyOjQFLS2fnovMHrDz9wftEixTACJKY1HFUmZbIk5GM4WkWyI/bg+AJD0CjKAmVhMlFPpchmaWUm4v8+HrElAu/Pmnz+RWmReGmU2QoYmRsRQHYdE2CbYMOaF51HOWNt1iJSoODFqeSd9YlAUe2g4+gVpjI0ZmoUspe/Lpfdqpk7cWH0QN0zVeOwqxnSjJtYVWi/fEO/DlDWZ2chX4W0vO1/EbgBHTnbxGOMU+UAAAAASUVORK5CYII=" alt="post en francais" class="Flag__FlagImage-sc-1n11y4w-0 jcNLtE flag"/>Productivité Ninja !</h2></header><section><p>Entre le  multitasking , les mails pro, les notifications push sur votre téléphone (SMS, mail perso, Facebook, Twitter...), un collègue qui…</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 joXPMq">7<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 kRszmU"></span><div class="TagList__ListContainer-tgjq80-0 eesUgi"><span to="/tags/Productivity" class="TagList__TagListItem-tgjq80-2 eOjJiY">Productivity</span>, <span to="/tags/TimeManagement" class="TagList__TagListItem-tgjq80-2 eOjJiY">TimeManagement</span></div></footer></div></a></article><article class="PrevNextPost__Preview-sc-1r1qyep-1 idbZOY"><a aria-label="View Une stack Docker pour votre application Symfony article" href="/docker-pour-symfony"><div style="background-image:url(&quot;/static/5c0fc80016b5712b22430194cdb7ba81/bg-intro.jpg&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 lanPji"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 enysgX"><header><h2><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAKnRFWHRDcmVhdGlvbiBUaW1lAEZyIDkgTm92IDIwMDcgMTY6Mjc6MDYgKzAxMDAM3ZqdAAAAB3RJTUUH1wsJDxwzm8yD2gAAAAlwSFlzAAALEgAACxIB0t1+/AAAAARnQU1BAACxjwv8YQUAAAHdSURBVHjaxVO7btRAFD3zsNdxQIqQqBYk6ghR0tLxDXwCn8HX0BGlo6JCKAqCIlVCkCjQLgkgxbDB67XnlXPHRvsJGWs04/F53ZkxcNtNvXj5arG7uzf3KfJNIUSFh/dn2H9Qc564pABj0Z98hPt6CsVHyzoCrv6tl/bO3Xvzx0+fw0cveugp8ORRjWf7e1lAmi5naKuAHh2QSI4RpQbeHBzOrSfIBQ/vAzWRE8jcDQNCQk4g3TtinMtkEUHfIaxW0OIqa55rMTEYu3xXWm/r1AYZ5AYolqoJ6D4dU1jDCjFkMrskoFukKG2ys56EFEkyC38abE4+w1z/heU3K0Q/OUchp0zNxCCuU+sX37F69xZYt9CmQDHKUYDwQMPIONpo9A5o2gH9ZoPBjwKm5h78/glcs+ayylQtpyOjQFLS2fnovMHrDz9wftEixTACJKY1HFUmZbIk5GM4WkWyI/bg+AJD0CjKAmVhMlFPpchmaWUm4v8+HrElAu/Pmnz+RWmReGmU2QoYmRsRQHYdE2CbYMOaF51HOWNt1iJSoODFqeSd9YlAUe2g4+gVpjI0ZmoUspe/Lpfdqpk7cWH0QN0zVeOwqxnSjJtYVWi/fEO/DlDWZ2chX4W0vO1/EbgBHTnbxGOMU+UAAAAASUVORK5CYII=" alt="post en francais" class="Flag__FlagImage-sc-1n11y4w-0 jcNLtE flag"/>Une stack Docker pour votre application Symfony</h2></header><section><p>05/07/2016  : màj du docker-compose (suppression conteneur code+alias) + màj schéma + ajout PHPMyAdmin + simplification toolbox. Un grand…</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 joXPMq">2<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 kRszmU"></span><div class="TagList__ListContainer-tgjq80-0 eesUgi"><span to="/tags/Docker" class="TagList__TagListItem-tgjq80-2 eOjJiY">Docker</span>, <span to="/tags/Symfony2" class="TagList__TagListItem-tgjq80-2 eOjJiY">Symfony2</span>, <span to="/tags/PHP" class="TagList__TagListItem-tgjq80-2 eOjJiY">PHP</span></div></footer></div></a></article></aside></div><footer class="Footer__FooterWrapper-t92llg-0 cjpVI"><nav><div class="footer-col"><h3 class="footer-title">Maxence Poutord<!-- --> © <!-- -->2020</h3><p class="footer-item-text">Built with<!-- --> <a class="footer-link" href="https://www.gatsbyjs.org">Gatsby</a>.</p><p class="footer-item-text">Theme using<!-- --> <a class="footer-link" href="https://github.com/maxpou/gatsby-starter-morning-dew">gatsby-starter-morning-dew</a>.</p><p class="footer-item-text">Hosted with<!-- --> <span class="footer-heart" role="img" aria-label="Love">❤</span> <!-- -->by<!-- --> <a class="footer-link" href="https://github.com">GitHub</a>.</p></div><div class="footer-col"><h3 class="footer-title">Explore</h3><div class="footer-column-items"><span class="footer-item"><a class="footer-link" href="/">Blog</a></span><span class="footer-item"><a class="footer-link" href="/speaking">Speaking</a></span><span class="footer-item"><a class="footer-link" href="/portfolio">Portfolio</a></span><span class="footer-item"><a class="footer-link" href="/uses">Uses</a></span><span class="footer-item"><a class="footer-link" href="/about">About</a></span></div></div><div class="footer-col"><h3 class="footer-title">Follow me</h3><div class="footer-column-items"><span class="footer-item"><a class="footer-link" href="https://github.com/maxpou">GitHub</a></span><span class="footer-item"><a class="footer-link" href="https://twitter.com/_maxpou">Twitter</a></span><span class="footer-item"><a class="footer-link" href="https://www.linkedin.com/in/maxpou/">LinkedIn</a></span><span class="footer-item"><a class="footer-link" href="https://nomadlist.com/@maxpou">Nomad List</a></span><span class="footer-item"><a class="footer-link" href="https://dev.to/maxpou">Dev.to</a></span><span class="footer-item"><a class="footer-link" href="/rss">RSS</a></span></div></div></nav></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-67868977-2', 'auto', {});
      
      
      
      
      
      }</script><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-67868977-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/cache-doctrine-avec-redis";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-72fe72edc09187d23e20.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-0097d26fbd474b34ff9b.js"],"component---node-modules-gatsby-starter-morning-dew-src-pages-404-js":["/component---node-modules-gatsby-starter-morning-dew-src-pages-404-js-0087eeaba80adc7e8fdc.js"],"component---node-modules-gatsby-starter-morning-dew-src-templates-blog-list-template-js":["/component---node-modules-gatsby-starter-morning-dew-src-templates-blog-list-template-js-5179015db0f40119f4a4.js"],"component---node-modules-gatsby-starter-morning-dew-src-templates-blog-post-js":["/component---node-modules-gatsby-starter-morning-dew-src-templates-blog-post-js-2bec6febe87b94e09fbd.js"],"component---node-modules-gatsby-starter-morning-dew-src-templates-page-js":["/component---node-modules-gatsby-starter-morning-dew-src-templates-page-js-317d10a78bc6b674988f.js"],"component---node-modules-gatsby-starter-morning-dew-src-templates-tags-js":["/component---node-modules-gatsby-starter-morning-dew-src-templates-tags-js-2d9588c5ddccddf159c8.js"]};/*]]>*/</script><script src="/component---node-modules-gatsby-starter-morning-dew-src-templates-blog-post-js-2bec6febe87b94e09fbd.js" async=""></script><script src="/cd67464b56c598a654fc65ad34d4a5dd4dc63f41-8a06726a359f3d026d46.js" async=""></script><script src="/75f61cbc8b4957b70288e42efd9d48e28ad28b43-9c65d1c119555ed86450.js" async=""></script><script src="/styles-c2fe8482057191dca484.js" async=""></script><script src="/app-72fe72edc09187d23e20.js" async=""></script><script src="/framework-95b680cb3190aa9bfe59.js" async=""></script><script src="/webpack-runtime-25d10a0ba71c72a2011c.js" async=""></script></body></html>